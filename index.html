<!doctype html>
const i18n = {
fr: { home:'Accueil', products:'Produits', topup:'Recharger', balance:'Solde', credits:'crédits', why_title:'Pourquoi cette boutique existe', why_text:'Mode démo activé : pas de crypto, juste pour tester l’interface. Chaque article coûte <strong>8 crédits</strong>.', products_title:'Articles à vendre', back:'Retour', hidden_label:'Contenu caché', price:'Prix', pay:'Payer', topup_title:'Recharger en crypto', demo_topup:'En mode démo, cette partie est désactivée.', confirm_title:"Confirmer l'achat", confirm_text:'Voulez-vous dépenser 8 crédits pour cet article ?', cancel:'Annuler', confirm:'Confirmer' },
en: { home:'Home', products:'Products', topup:'Top up', balance:'Balance', credits:'credits', why_title:'Why this shop exists', why_text:'Demo mode: no crypto, just testing the UI. Each item costs <strong>8 credits</strong>.', products_title:'Items for sale', back:'Back', hidden_label:'Hidden Content', price:'Price', pay:'Pay', topup_title:'Top up with crypto', demo_topup:'In demo mode, this section is disabled.', confirm_title:'Confirm purchase', confirm_text:'Do you want to spend 8 credits for this item?', cancel:'Cancel', confirm:'Confirm' },
};
let lang = localStorage.getItem('lang') || 'fr';


function t(key){ return (i18n[lang] && i18n[lang][key]) || key; }
function applyI18n(){
document.querySelectorAll('[data-t]').forEach(el => {
const k = el.getAttribute('data-t');
if (k === 'why_text') el.innerHTML = t(k); else el.textContent = t(k);
});
document.documentElement.lang = lang;
document.getElementById('lang').value = lang;
}


const $ = (id) => document.getElementById(id);
function show(section){ ['section-home','section-products','section-topup','section-detail'].forEach(id => $(id).classList.add('hidden')); $(section).classList.remove('hidden'); }


function renderGrid(){
const grid = $('grid'); grid.innerHTML = '';
products.forEach(p => {
const card = document.createElement('div');
card.className = 'rounded-2xl border bg-white overflow-hidden hover:shadow';
card.innerHTML = `
<img src="${p.image_url}" class="w-full h-40 object-cover" alt="${p.name}">
<div class="p-4 space-y-2">
<div class="font-semibold">${p.name}</div>
<div class="text-sm text-slate-600">${p.description}</div>
<a class="btn w-full mt-2" href="#/product/${p.id}">${lang==='en'?'View':'Voir'}</a>
</div>`;
grid.appendChild(card);
});
}


function renderDetail(id){
const p = products.find(x => x.id === Number(id));
if (!p) { location.hash = '#/products'; return; }
$('d-img').src = p.image_url; $('d-img').alt = p.name;
$('d-title').textContent = p.name;
$('d-desc').textContent = p.description;
$('d-hidden').textContent = p.link; $('d-hidden').classList.add('blur-sm');
$('btn-pay').onclick = () => openConfirm(() => reveal());
function reveal(){ $('d-hidden').classList.remove('blur-sm'); }
show('section-detail');
}


function onRoute(){
const hash = location.hash || '#/home';
const parts = hash.split('/');
const route = parts[1] ? parts[1].replace('#','') : 'home';
const param = parts[2];
if (route === 'home') show('section-home');
else if (route === 'products') { renderGrid(); show('section-products'); }
else if (route === 'topup') show('section-topup');
else if (route === 'product') renderDetail(param);
else { location.hash = '#/home'; }
}
window.addEventListener('hashchange', onRoute);


function openConfirm(onOk){
$('confirm').classList.remove('hidden');
const ok = () => { close(); onOk && onOk(); };
const cancel = () => close();
function close(){ $('confirm').classList.add('hidden'); $('c-ok').removeEventListener('click', ok); $('c-cancel').removeEventListener('click', cancel); }
$('c-ok').addEventListener('click', ok);
$('c-cancel').addEventListener('click', cancel);
}


$('back').onclick = () => history.back();
$('lang').onchange = (e) => { lang = e.target.value; localStorage.setItem('lang', lang); applyI18n(); renderGrid(); };


applyI18n();
$('balance').textContent = 24;
if (!location.hash) location.hash = '#/home';
onRoute();
})();
</script>
</body>
</html>
